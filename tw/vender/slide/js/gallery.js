$(function(){$.fn.imagesLoaded=function(i){function e(){i.call(a,n)}function t(){0>=--r&&this.src!==l&&(setTimeout(e),n.off("load error",t))}var n=this.find("img"),r=n.length,a=this,l="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";return r||e(),n.on("load error",t).each(function(){if(this.complete||void 0===this.complete){var i=this.src;this.src=l,this.src=i}}),this};var i=$("#rg-gallery"),e=i.find("div.es-carousel-wrapper"),t=e.find("ul > li"),n=t.length;Gallery=function(){var r=0,a="carousel",l=!1,d=function(){t.add('<img src="images/ajax-loader.gif"/><img src="images/black.png"/>').imagesLoaded(function(){s(),f(t.eq(r))}),"carousel"===a&&o()},o=function(){e.show().elastislide({imageW:65,onClick:function(i){return l?!1:(l=!0,f(i),r=i.index(),void 0)}}),e.elastislide("setCurrent",r)},s=function(){if($("#img-wrapper-tmpl").tmpl({itemsCount:n}).appendTo(i),n>1){var e=i.find("a.rg-image-nav-prev"),t=i.find("a.rg-image-nav-next"),r=i.find("div.rg-image");e.on("click.rgGallery",function(){return c("left"),!1}),t.on("click.rgGallery",function(){return c("right"),!1}),r.touchwipe({wipeLeft:function(){c("right")},wipeRight:function(){c("left")},preventDefaultEvents:!1}),$(document).on("keyup.rgGallery",function(i){39==i.keyCode?c("right"):37==i.keyCode&&c("left")})}},c=function(i){return l?!1:(l=!0,"right"===i?r+1>=n?r=0:++r:"left"===i&&(0>r-1?r=n-1:--r),f(t.eq(r)),void 0)},f=function(n){var d=i.find("div.rg-loading").show();t.removeClass("selected"),n.addClass("selected");var o=n.find("img"),s=o.data("large"),c=o.data("description");n.find($(".story_text")),$("<img/>").load(function(){i.find("div.rg-image").empty().append('<img src="'+s+'"/>'),c&&i.find("div.rg-caption").show().children("p").empty().text(c),d.hide(),"carousel"===a&&(e.elastislide("reload"),e.elastislide("setCurrent",r)),l=!1}).attr("src",s)},g=function(i){e.find("ul").append(i),t=t.add($(i)),n=t.length,e.elastislide("add",i)};return{init:d,addItems:g}}(),Gallery.init()});